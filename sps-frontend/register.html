<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Share Payment SNS</title>

    <!-- Custom fonts for this template-->
    <link href="./lib/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="./lib/bootstrap/css/sb-admin-2.min.css" rel="stylesheet">


    <!-- Bootstrap core JavaScript-->
    <script src="./lib/bootstrap/js/jquery.min.js"></script>
    <script src="./lib/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="./lib/bootstrap/js/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="./lib/bootstrap/js/sb-admin-2.min.js"></script>

    <!-- Validation check -->
    <script type="text/javascript" src="lib/jquery/jquery.validate.min.js"></script>

    <!-- Slider -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js"
        integrity="sha512-f0VlzJbcEB6KiW8ZVtL+5HWPDyW1+nJEjguZ5IVnSQkvZbwBt2RfCBY0CBO1PsMAqxxrG4Di6TfsCPP3ZRwKpA=="
        crossorigin="anonymous"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.min.css"
        integrity="sha512-3q8fi8M0VS+X/3n64Ndpp6Bit7oXSiyCnzmlx6IDBLGlY5euFySyJ46RUlqIVs0DPCGOypqP8IRk/EyPvU28mQ=="
        crossorigin="anonymous" />


    <style>
        .family__sliderLable {
            margin-top: 7px;
            margin-right: 5px;
            padding-left: 5px;
        }

        /* .family__sliderValue {
            margin-left: 15px;
        } */

        .gender__sliderLable {
            margin-top: 7px;
            margin-right: 5px;
            margin-left: 10px
        }

        .form__gender__budget {
            text-align: center;
        }


        .hidden__value__logintype,
        .hidden__value__finaccount {
            display: none;
        }

        /* Bootstrap tooltip Custom */
        .tooltip-inner {
            white-space: pre-wrap;
            background-color: rgba(51, 124, 246, 1);
        }

        .tooltip.bs-tooltip-auto[x-placement^=bottom] .arrow::before,
        .tooltip.bs-tooltip-bottom .arrow::before {
            margin-left: -3px;
            text-align: center;
            border-width: 0 5px 5px;
            border-bottom-color: rgba(51, 124, 246, 1);
        }

        .label.error {
            color: red
        }
    </style>

</head>

<body class="bg-gradient-primary">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

    <div class="container">

        <div class="card o-hidden border-0 shadow-lg my-5">
            <div class="card-body p-0">
                <!-- Nested Row within Card Body -->
                <div class="row">
                    <div class="col-lg-5 d-none d-lg-block bg-register-image"></div>
                    <div class="col-lg-7">
                        <div class="p-5">
                            <div class="text-center">
                                <h1 class="h4 text-gray-900 mb-4">Create an Account!</h1>
                            </div>
                            <form id="auth-form" class="user">
                                <div class="form-group">
                                    <input id="id" type="email" name="id" class="form-control form-control-user"
                                        placeholder="Email Address">
                                </div>
                                <div class="form-group">
                                    <input id="password" name="password" type="password"
                                        class="form-control form-control-user" placeholder="Password">
                                </div>
                                <div class="form-group">
                                    <input id="name" name="name" type="text" class="form-control form-control-user"
                                        placeholder="Name">
                                </div>
                                <div class="form-group">
                                    <label for="birthday" class="sr-only">birthday</label>
                                    <input type="text" name="birthday" id="birthday"
                                        class="form-control form-control-user" placeholder="Birthday (yyyymmdd) ">
                                </div>
                                <div class="form-group row form__gender__budget">
                                    <div class="col-sm-4 mb-3 mb-sm-0">
                                        <!-- <label for="formControlRange" class="gender__sliderLable">Gender :
                                        </label> -->
                                        &nbsp;&nbsp;&nbsp;
                                        <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                            <label class="btn btn-primary button-class1">
                                                <input type="radio" name="gender" id="gender" autocomplete="off"
                                                    value="1" checked> Female
                                            </label>
                                            <label class="btn btn-default button-class2">
                                                <input type="radio" name="gender" id="gender" autocomplete="off"
                                                    value="0"> Male
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-sm-8 mb-3 mb-sm-0">
                                        <label for="formControlRange" class="family__sliderLable">Family : </label>
                                        <!-- <input type="range" class="form-control-range" id="formControlRange"> -->
                                        <input id="family" type="text" name="family" data-slider-min="1"
                                            data-slider-max="5" data-slider-step="1" /> &nbsp;&nbsp;&nbsp;
                                        <span class="family__sliderValue"></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="budget" class="sr-only">budget</label>
                                    <input type="number" name="budget" id="budget"
                                        class="form-control form-control-user" placeholder="Monthly Budget">
                                </div>
                                <div class="form-group">
                                    <input type="text" name="login_type" id="login_type"
                                        class="form-control hidden__value__logintype" placeholder="login_type">
                                    <input type="text" name="fin_account" id="fin_account"
                                        class="form-control hidden__value__finaccount" placeholder="fin_account">
                                </div>
                                <button type="submit" class="btn btn-primary btn-user btn-block">Sign up</button>
                                <hr>
                                <a href="index.html" class="btn btn-google btn-user btn-block">
                                    <i class="fab fa-google fa-fw"></i> Register with Google
                                </a>
                                <a href="index.html" class="btn btn-facebook btn-user btn-block">
                                    <i class="fab fa-facebook-f fa-fw"></i> Register with Facebook
                                </a>
                            </form>
                            <form id="card-form" class="card-form" name="card-form" style="display:none">
                                <!-- 여기 막기 -->
                                <!-- ID 는 은행마다 고유 번호 value 값으로 지정-->
                                <!-- <div class="form-group">
                                            <label for="id" class="sr-only">id</label>
                                            <input type="text" name="id" id="id" class="form-control" placeholder="ID">
                                        </div> -->

                                <!--은행 선택 3*3 추후 이미지 리사이징 해서 넣어야 함-->
                                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                    <div class="btn-group-vertical">
                                        <label class="btn btn-light btn-sm active">
                                            <!-- 농협은행 -->
                                            <input type="radio" name="id" value="011" hidden />
                                            <img src="public/images/cardicons/nh.png" width="150px" />
                                        </label>
                                        <label class="btn btn-light btn-sm">
                                            <!-- 하나은행 -->
                                            <input type="radio" name="id" value="081" hidden />
                                            <img src="public/images/cardicons/kebhana.png" width="150px" />
                                        </label>
                                        <label class="btn btn-light btn-sm">
                                            <!-- 국민은행 -->
                                            <input type="radio" name="id" value="004" hidden />
                                            <img src="public/images/cardicons/kb.png" width="150px" />
                                        </label>
                                    </div>
                                    <div class="btn-group-vertical">
                                        <label class="btn btn-light btn-sm">
                                            <!-- 농협상호금융 -->
                                            <input type="radio" name="id" value="012" hidden />
                                            <img src="public/images/cardicons/localnh.png" width="150px" />
                                        </label>
                                        <label class="btn btn-light btn-sm">
                                            <!-- 우리은행 -->
                                            <input type="radio" name="id" value="020" hidden />
                                            <img src="public/images/cardicons/woori.png" width="150px" />
                                        </label>
                                        <label class="btn btn-light btn-sm">
                                            <!-- 신한은행 -->
                                            <input type="radio" name="id" value="088" hidden />
                                            <img src="public/images/cardicons/shinhan.png" width="150px" />
                                        </label>
                                    </div>
                                    <div class="btn-group-vertical" width="150px">
                                        <label class="btn btn-light btn-sm">
                                            <!-- 카카오뱅크 -->
                                            <input type="radio" name="id" value="090" hidden />
                                            <img src="public/images/cardicons/kakao.png" width="150px" />
                                        </label>
                                        <label class="btn btn-light btn-sm">
                                            <!-- 산업은행 -->
                                            <input type="radio" name="id" value="002" hidden />
                                            <img src="public/images/cardicons/kdb.png" width="150px" />
                                        </label>
                                        <label class="btn btn-light btn-sm">
                                            <!-- 기업은행 -->
                                            <input type="radio" name="id" value="003" hidden />
                                            <img src="public/images/cardicons/ibk.png" width="150px" />
                                        </label>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="name" class="sr-only">name</label>
                                    <input type="text" name="name" id="name" class="form-control"
                                        placeholder="Card Name" minlength="3">
                                </div>
                                <div class="form-group">
                                    <label for="cardno" class="sr-only">cardno</label>
                                    <input type="text" name="cardno" id="cardno" class="form-control"
                                        placeholder="Card Number">
                                </div>
                                <button type="submit" class="btn btn-primary btn-block mb-3">Register</button>
                            </form>



                            <!-- 잃어버린 비밀번호 찾기 ***  
                            <div class="text-center">
                                <a class="small" href="forgot-password.html">Forgot Password?</a>
                            </div> -->
                            <div class="text-center">
                                <a class="small" href="login.html">Already have an account? Login!</a>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

<script>
    // 'use strict';

    //------------------------------Get Dom------------------------------//
    const signForm = document.getElementById('auth-form');
    const cardForm = document.getElementById("card-form");


    //------------------------------Function------------------------------//
    const makeRandomId = () => String(Math.floor(Math.random() * (20)));

    // Set Category Form Atcion (submit)
    const cardApproveFetch = () => {
        // static 
        const dataBody = {
            "startDate": "2020-11-01",
            "endDate": "2020-12-01",
            "pageNo": "1",
            "cnt": 15
        };

        // fetching body
        fetch('http://44.242.175.149:3000/user/card/approve', {
            method: 'POST', // *GET, POST, PUT, DELETE, etc.
            mode: 'cors', // no-cors, cors, *same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            credentials: 'include', // include, *same-origin, omit 
            headers: { 'Content-Type': 'application/json', },
            // redirect: 'follow', // manual, *follow, error
            // referrer: 'no-referrer', // no-referrer, *client
            body: JSON.stringify(dataBody) // body data type must match "Content-Type" header
        }).then((response) => {
            const { status } = response;
            // console.log(status + ", " + typeof(status));
            if (status === 403) return Promise.reject(new Error("로그인 해야 볼 수 있는 페이지 입니다."));
            else if (status === 400 || status === 404) return Promise.reject(new Error("유저 ID에 맞는 카드 넘버 정보를 가져주세요!"));
            else if (status === 422) return Promise.reject(new Error("올바론 값을 입력해 주세요!"));
            return Promise.resolve("회원 가입 및 카드 등록 성공!"); // async promise 성공시 반환이라 생각 
        }).then((data) => { // 성공하면 여기오고
            // console.log(data);
        }).catch((error) => { // 실패하면 여기온다
            console.warn(error);
            Swal.fire({
                text: error,
                confirmButtonText: 'OK'
            })
        });
    };

    //------------------------------Main------------------------------//

    function init() {

        // Add SignUp Fetching
        signForm.addEventListener('submit', function (event) {
            event.preventDefault();


            console.log(Object.fromEntries(new FormData(event.target)));
            //const formData = new FormData(form);

            fetch('http://44.242.175.149:3000/user', {
                method: 'POST', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, cors, *same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'include', // include, *same-origin, omit 
                headers: {
                    'Content-Type': 'application/json',
                    // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                // redirect: 'follow', // manual, *follow, error
                // referrer: 'no-referrer', // no-referrer, *client
                body: JSON.stringify(Object.fromEntries(new FormData(event.target))) // // body data type must match "Content-Type" header
            }).then((response) => {
                const { status } = response;
                // console.log(status + ", " + typeof(status));
                if (status === 400) return Promise.reject(new Error("ID가 이미 존재합니다!!"));
                else if (status === 422 || status === 404) return Promise.reject(new Error("올바른 ID, Password, 생년월일(yyymmdd)값을 입력해 주세요!"));
                return Promise.resolve("회원가입 성공, 카드 등록을 바로 해주셔야 원활한 서비스 이용이 가능합니다!");
            }).then((data) => { // 성공하면 여기오고
                // console.log(data);
                //card form 생성 및 auth form 사라짐
                if (cardForm.style.display == 'none') {
                    cardForm.style.display = 'block';
                    $("#auth-form").hide();
                }
            }).catch((error) => { // 실패하면 여기온다
                console.warn(error);
                Swal.fire({
                    text: error,
                    confirmButtonText: 'OK'
                })
            });
        });

        // Add Card Fetching
        cardForm.addEventListener('submit', function (event) {
            event.preventDefault();

            // set id value to Unique
            let dataBody = Object.fromEntries(new FormData(event.target));
            dataBody['id'] += (dataBody['name'] + makeRandomId());
            console.log(dataBody);
            // fetching body
            fetch('http://44.242.175.149:3000/user/card', {
                method: 'POST', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, cors, *same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'include', // include, *same-origin, omit 
                headers: {
                    'Content-Type': 'application/json',
                },
                // redirect: 'follow', // manual, *follow, error
                // referrer: 'no-referrer', // no-referrer, *client
                body: JSON.stringify(dataBody) // body data type must match "Content-Type" header
            }).then((response) => {
                const { status } = response;
                // console.log(status + ", " + typeof(status));
                if (status === 400) return Promise.reject(new Error("앞선 회원가입 정보가 잘못 되었습니다!"));
                else if (status === 422 || 404) return Promise.reject(new Error("올바른 카드넘버 (카드번호)를 입력해 주세요!"));
                return Promise.resolve("회원 가입 및 카드 등록 성공!"); // async promise 성공시 반환이라 생각 
            }).then((data) => { // 성공하면 여기오고
                // console.log(data);
                Swal.fire({
                    title: ' ',
                    text: data,
                    confirmButtonText: 'OK'
                }).then((result) => {
                    if (result.isConfirmed) {
                        cardApproveFetch();
                        window.location.href = "history.html"; // main html로 강제 이동시킴 
                    }
                })

            }).catch((error) => { // 실패하면 여기온다
                console.warn(error);
                Swal.fire({
                    text: error,
                    confirmButtonText: 'OK'
                })
            });
        });

        // about slider

    }

    //------------------------------document get ready------------------------------//
    document.addEventListener("DOMContentLoaded", function () {
        init();

        // jQuery
        $('[data-toggle="tooltip"]').tooltip();

        // With JQuery for slider
        $("#family").slider(); // setting up jquery slider
        const defaultSliderValue = $("#family").val();
        $("#ex6SliderVal").text(defaultSliderValue); // jquery slider options
        $('.family__sliderValue').text(defaultSliderValue);

        $("#family").on("slide", function (slideEvt) {
            $("#ex6SliderVal").text(slideEvt.value);
            $('.family__sliderValue').text(slideEvt.value);
        });
    });

</script>

<!-- gender button exchange event JS -->
<script type="text/javascript">
    $(function () {

        $('.button-class1').click(function () {
            if ($(this).hasClass('btn-default')) $(this).removeClass('btn-default');
            if (!$(this).hasClass('btn-primary')) $(this).addClass('btn-primary');
            if ($('.button-class2').hasClass('btn-primary')) $('.button-class2').removeClass('btn-primary');
            if (!$('.button-class2').hasClass('btn-default')) $('.button-class2').addClass('btn-default');
        });

        $('.button-class2').click(function () {
            if ($(this).hasClass('btn-default')) $(this).removeClass('btn-default');
            if (!$(this).hasClass('btn-primary')) $(this).addClass('btn-primary');
            if ($('.button-class1').hasClass('btn-primary')) $('.button-class1').removeClass('btn-primary');
            if (!$('.button-class1').hasClass('btn-default')) $('.button-class1').addClass('btn-default');
        });

    });
</script>

</html>