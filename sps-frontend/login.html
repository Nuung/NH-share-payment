<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>SPS Login</title>
	<!-- Required meta tags -->
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Bootstrap CSS -->
	<link defer rel="stylesheet" href="./lib/bootstrap/css/bootstrap.min.css" />
</head>

<body>
	<div class="container">
		<div class="row">
			<div class="col-7">
				<img src="./public/images/Frame 2.png" style="height: 750px">
			</div>
			<div class="col-4">
				<br><br><br><br><br><br><br>
				<form id="form__login">
					<p></p>
					<p class="font-weight-bold" style="font-size: xx-large;">Login to your account</p>
					<br>
					<div class="form-group">
						<label for="exampleInputEmail1">Email address</label>
						<input type="email" class="form-control" id="id" name="id" aria-describedby="emailHelp"
							required>
					</div>
					<div class="form-group">
						<label for="exampleInputPassword1">Password</label>
						<input type="password" class="form-control" id="password" name="password" required>
						<p class=“mb-0 d-flex”>
							<a href=“#” class=“btn btn-light btn-block mr-2”>Sign up with google</a>
							<a href=“#” class=“btn btn-facebook mr-2”> <i class=“mdi mdi-facebook”></i></a>
							<a href=“#” class=“btn btn-twitter”><i class=“mdi mdi-twitter”></i></a>
						</p>
						<button id="login__btn" type="submit" class="btn btn-primary btn-block">Login now</button>
						<button class="btn btn-success btn-block">Sign up</button>
				</form>
			</div>
		</div>
	</div>
</body>
<!-- JS File -->
<script>
	'use strict';

	//------------------------------Get Dom------------------------------//

	const form = document.getElementById('form__login');


	//------------------------------Function------------------------------//




	//------------------------------Main------------------------------//

	/* 
	Pending(대기) : 비동기 처리 로직이 아직 완료되지 않은 상태
	Fulfilled(이행) : 비동기 처리가 완료되어 프로미스가 결과 값을 반환해준 상태 => resolve를 하면 fulfilled된 상태가 된거임 
	Rejected(실패) : 비동기 처리가 실패하거나 오류가 발생한 상태
	*/

	function init() {

		form.addEventListener('submit', function (event) {
			// casting Form to JSON data
			// console.log(JSON.stringify(Object.fromEntries(new FormData(event.target))));

			// 원래 이벤트 발동 X
			event.preventDefault();
			fetch('http://localhost:3000/user/login', {
				method: 'POST', // *GET, POST, PUT, DELETE, etc.
				mode: 'cors', // no-cors, cors, *same-origin
				cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
				credentials: 'same-origin', // include, *same-origin, omit
				headers: {
					'Content-Type': 'application/json',
					// 'Content-Type': 'application/x-www-form-urlencoded',
				},
				// redirect: 'follow', // manual, *follow, error
				// referrer: 'no-referrer', // no-referrer, *client
				body: JSON.stringify(Object.fromEntries(new FormData(event.target))) // // body data type must match "Content-Type" header
			}).then((response) => {
				const { status } = response;
				// console.log(status + ", " + typeof(status));
				if (status === 404) {
					return Promise.reject(new Error("ID or Password가 틀립니다!"));
				}
				else if (status === 422) {
					return Promise.reject(new Error("올바른 ID, Password값을 입력해 주세요!"));
				}
				else if (status === 201) {
					return Promise.resolve("Login 성공!"); // async promise 성공시 반환이라 생각 
				}
				else return Promise.reject(new Error("Login Request is failed")); // async promise 실패시 반환이라 생각 
			}).then((data) => { // 성공하면 여기오고
				console.log(data);
				alert(data);
				window.location.href = "main.html"; // main html로 강제 이동시킴 
			}).catch((error) => { // 실패하면 여기온다
				console.warn(error);
				alert(error);
			});
		});
	}

	init();
</script>

</html>