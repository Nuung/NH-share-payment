<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SPS-CardRegister</title>

    <!-- Custom fonts for this template-->
    <link href="./lib/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="./lib/bootstrap/css/sb-admin-2.min.css" rel="stylesheet">

    <style>
        .card__list {
            position: absolute;
            top: 50%;
            left : 50%;
            text-align: center;
            border-radius: 15px;
            width: 30rem;
            margin: 5px;
        }

        [type=radio] { 
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        [type=radio] + div {
            cursor: pointer;
        }
        
        [type=radio]:checked + div {
            outline: 5px solid indigo;
        }

        .card-body {
            /* display: flex; */
            align-items: center;
            justify-content: center;
        }

        .card-body>input {
            cursor: pointer;
            width: 100%;
            margin: 5px;
            opacity: 0.6;
            transition: 0.3s;
        }

        .card-body>input:hover {
            opacity: 1
        }

        /* 모바일 환경 */
        @media (max-width: 768px) {
            #card__list {
                /* width: 20rem; */
                width: 20rem;
            }

            .card-body>img {
                width: 60%;
                margin-left : 40px;

            }
        }


    </style>

</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-laugh-wink"></i>
                </div>
                <div class="sidebar-brand-text mx-3">Share Payment SNS <sup></sup></div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- 왼쪽 네비게이션 메뉴 중 SNS -->
            <li class="nav-item">
                <a class="nav-link" href="SNS.html">
                    <i class="fas fa-fw fa-user-alt"></i>
                    <span>SNS</span></a>
            </li>

            <!-- 구분선 -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading">
            </div>

            <!--히스토리, 마이페이지 메뉴-->
            <li class="nav-item">
                <a class="nav-link" href="history.html">
                <i class="fas fa-fw fa-history"></i>

                    <span>History</span>&nbsp;<span class="badge badge-pill badge-light ">9</span></a>
                    <!--숫자에 처리해야 할 히스토리 개수-->
            </li>

            <!-- 날짜, 투데이, 항목별 -->
            <li class="nav-item active">
                <a class="nav-link" href="#" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true"
                    aria-controls="collapseTwo">
                    <i class="fas fa-fw fa-wallet"></i>
                    <span>Mypage</span>
                </a>
                <div id="collapseTwo" class="collapse show" aria-labelledby="headingTwo"
                    data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <a class="collapse-item" href="mypage-today.html"><i class="fas fa-fw fa-check"></i>&nbsp;&nbsp;Today</a>
                        <!--현재 페이지에 active 효과 넣어서 글씨 진하게-->
                        <a class="collapse-item" href="mypage-day.html"><i class="fas fa-fw fa-calendar"></i>&nbsp;&nbsp;날짜별</a>
                        <a class="collapse-item active" href="mypage-item.html"><i class="fas fa-fw fa-th-list"></i>&nbsp;&nbsp;항목별</a>
                    </div>
                </div>
            </li>



            <!-- 구분선 -->
            <hr class="sidebar-divider d-none d-md-block">

            <!-- Sidebar Message -->
            <div class="sidebar-card">
                <img class="sidebar-card-illustration mb-2" src="public/images/cardImg.png" alt="">
                <p class="text-center mb-2"><strong></strong></p>
                <a class="btn btn-success btn-sm" href="http://localhost:8080/cardForm.html"> Register <br /> your own cards.</a>
            </div>

            <!-- Sidebar Toggler (Sidebar) 누르면 네비게이션 최소화-->
            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>

        </ul>
        <!-- End of Sidebar -->


        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- 상단 바 - 추가할 컨텐츠 상의해보기-->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                    <!-- Sidebar Toggle (Topbar) -->
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <!-- Topbar Navbar -->
                    <ul class="navbar-nav ml-auto">
                        <!-- 로그아웃 !!쿠키 삭제 추가해야 함!! -->
                            <a class="nav-item" href="#" data-toggle="modal" data-target="#logoutModal">
                                <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                Logout &nbsp;&nbsp;&nbsp;
                            </a>
                    </ul>
                </nav>
                <!-- End of Topbar -->


                <!-- 메인 페이지 Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <h1 class="h3 mb-2 text-gray-800">Card Management</h1>
                    <p class="mb-4">자신의 카드등록 파악 및 신규 카드 등록</p>

                    <!-- Content Row -->
                    <div class="row">
                        
                        <!-- REGISTERED CARDS -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                농협신용카드</div>
                                            <div class="text-md mb-0 font-weight-bold text-gray-800">4523-4623-1234-0098</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-calendar fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                농협체크카드</div>
                                            <div class="text-md mb-0 font-weight-bold text-gray-800">4523-4623-1234-1010</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-calendar fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                    
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">신한카드
                                            </div>
                                            <div class="row no-gutters align-items-center">
                                                <div class="col-auto">
                                                    <div class="text-md mb-0 mr-3 font-weight-bold text-gray-800">4523-1243-6879-1011</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-calendar fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                우리카드</div>
                                            <div class="text-md mb-0 font-weight-bold text-gray-800">3345-1234-7865-3489</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-calendar fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END OF REGISTERED CARDS -->
                    
                       
                    <!-- REGISTER CARD FORM -->        
                    <div class="row">    

                        <div class="col-xl-5 col-lg-5">
                            <div class="card shadow mb-4">
                                
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">신규 카드 등록</h6>
                                </div>
                            
                                <form id="card-form" class="card-form" name="card-form">
                                    <div class="card-body" id="card__list">
                                        <div class="form-group">
                                        <div class="row">
                                            <div class="col-lg-3 mb-3">
                                                <div class="card bg-light text-white shadow">
                                                    <div class="card-body">
                                                        <input type="radio" name="id" value="011" active>
                                                            <img src="public/images/cardicons/nh.png" width="100%"/>
                                                        </input>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-lg-3 mb-3">
                                                <div class="card bg-light text-white shadow">
                                                    <div class="card-body">
                                                        <input type="radio" name="id" value="012">
                                                            <img src="public/images/cardicons/localnh.png" width="100%"/>
                                                        </input>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-lg-3 mb-3">
                                                <div class="card bg-light text-white shadow">
                                                    <div class="card-body">
                                                        <input type="radio" name="id" value="081">
                                                            <img src="public/images/cardicons/kebhana.png" width="100%" height="auto"/>
                                                        </input>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-lg-3 mb-3">
                                                <div class="card bg-light text-white shadow">
                                                    <div class="card-body">
                                                        <input type="radio" name="id" value="004">
                                                            <img src="public/images/cardicons/kb.png" width="100%" height="auto"/>
                                                        </input>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-3 mb-3">
                                                <div class="card bg-light text-white shadow">
                                                    <div class="card-body">
                                                        <input type="radio" name="id" value="020">
                                                            <img src="public/images/cardicons/woori.png" width="100%" height="auto"/>
                                                        </input>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-3 mb-3">
                                                <div class="card bg-light text-white shadow">
                                                    <div class="card-body">
                                                        <input type="radio" name="id" value="088">
                                                            <img src="public/images/cardicons/shinhan.png" width="100%" height="auto"/>
                                                        </input>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-lg-3 mb-3">
                                                <div class="card bg-light text-black shadow">
                                                    <div class="card-body">
                                                        <input type="radio" name="id" value="090">
                                                            <img src="public/images/cardicons/kakao.png" width="100%" height="auto"/>
                                                        </input>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-3 mb-3">
                                                <div class="card bg-light text-white shadow">
                                                    <div class="card-body">
                                                        <input type="radio" name="id" value="002">
                                                            <img src="public/images/cardicons/kdb.png" width="100%" height="auto"/>
                                                        </input>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-3 mb-3">
                                                <div class="card bg-light text-white shadow">
                                                    <div class="card-body">
                                                        <input type="radio" name="id" value="003">
                                                            <img src="public/images/cardicons/ibk.png" width="100%" height="auto"/>
                                                        </input>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="name" class="sr-only">name</label>
                                            <input type="text" name="name" id="name" class="form-control" placeholder="Card Name" minlength="3">
                                        </div>
                                        <div class="form-group">
                                            <label for="cardno" class="sr-only">cardno</label>
                                            <input type="text" name="cardno" id="cardno" class="form-control" placeholder="Card Number">
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-block mb-3">Register</button>
                                </form>
                                <!-- END OF FORM -->
                            </div>
                        </div>
                    </div>
                    <!-- END OF REGISTER CARDS -->    

                </div>
                <!-- END OF CONTAINER FLUID -->
            </div>
            <!-- END OF MAIN CONTENT -->

        </div>
        <!-- End of CONTENT WRAPPER -->

        <!-- Footer -->
        <footer class="sticky-footer bg-white">
            <div class="container my-auto">
                <div class="copyright text-center my-auto">
                    <span>Copyright &copy; Your Website 2020</span>
                </div>
            </div>
        </footer>
        <!-- End of Footer -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script src="./lib/bootstrap/js/jquery.min.js"></script>
    <script src="./lib/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="./lib/bootstrap/js/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="./lib/bootstrap/js/sb-admin-2.min.js"></script>

</body>

<!-- JS FILE -->
<script>
        //------------------------------Get Dom------------------------------//
        const cardForm = document.getElementById("card-form");

        //------------------------------Function------------------------------//
        const makeRandomId = () => String(Math.floor(Math.random() * (20)));
        
        //------------------------------Main------------------------------//
        
        // Set Category Form Atcion (submit)
        // const cardApproveFetch = () => {
        //         // static 
        //         const dataBody = {
        //             "startDate": "2020-11-01",
        //             "endDate": "2020-12-01",
        //             "pageNo": "1",
        //             "cnt": 15
        //         };

        //         // fetching body
        //         fetch('http://44.242.175.149:3000/user/card/approve', {
        //             method: 'POST', // *GET, POST, PUT, DELETE, etc.
        //             mode: 'cors', // no-cors, cors, *same-origin
        //             cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
        //             credentials: 'include', // include, *same-origin, omit 
        //             headers: { 'Content-Type': 'application/json', },
        //             // redirect: 'follow', // manual, *follow, error
        //             // referrer: 'no-referrer', // no-referrer, *client
        //             body: JSON.stringify(dataBody) // body data type must match "Content-Type" header
        //         }).then((response) => {
        //             const { status } = response;
        //             // console.log(status + ", " + typeof(status));
        //             if (status === 403) return Promise.reject(new Error("로그인 해야 볼 수 있는 페이지 입니다."));
        //             else if (status === 400 || status === 404) return Promise.reject(new Error("유저 ID에 맞는 카드 넘버 정보를 가져주세요!"));
        //             else if (status === 422) return Promise.reject(new Error("올바론 값을 입력해 주세요!"));
        //             // else return Promise.reject(new Error("로그인 해야 볼 수 있는 페이지 입니다."));
        //         }).then((data) => { // 성공하면 여기오고
        //             console.log(data);
        //         }).catch((error) => { // 실패하면 여기온다
        //             console.warn(error);
        //             Swal.fire({
        //                 text: error,
        //                 confirmButtonText: 'OK'
        //             })
        //         });
        //     };


        function init() {
            // Add Card Fetching
            cardForm.addEventListener('submit', function (event) {
                event.preventDefault();

                // set id value to Unique
                let dataBody = Object.fromEntries(new FormData(event.target));
                dataBody['id'] += (dataBody['name'] + makeRandomId());
                console.log(dataBody);
                // fetching body
                fetch('http://localhost:3000/user/card', {
                    method: 'POST', // *GET, POST, PUT, DELETE, etc.
                    mode: 'cors', // no-cors, cors, *same-origin
                    cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                    credentials: 'include', // include, *same-origin, omit 
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    // redirect: 'follow', // manual, *follow, error
                    // referrer: 'no-referrer', // no-referrer, *client
                    body: JSON.stringify(dataBody) // body data type must match "Content-Type" header
                }).then((response) => {
                    const { status } = response;
                    // console.log(status + ", " + typeof(status));
                    if (status === 403) return Promise.reject(new Error("앞선 회원가입 정보가 잘못 되었습니다!"));
                    else if (status === 422) return Promise.reject(new Error("올바른 카드넘버 (카드번호)를 입력해 주세요!"));
                    else if (status === 201) return Promise.resolve("회원가입 성공!"); // async promise 성공시 반환이라 생각 
                    // else return Promise.reject(new Error("Create User Card Request is failed")); // async promise 실패시 반환이라 생각 
                }).then((data) => { // 성공하면 여기오고
                    console.log(data);
                    alert('등록 완료');
                    // Swal.fire({
                    //     text: "등록 완료",
                    //     confirmButtonColor: '#4E73DF',
                    //     confirmButtonText: 'OK',
                    // });
                    
                }).catch((error) => { // 실패하면 여기온다
                    console.warn(error);
                    // Swal.fire({
                    //     text: error,
                    //     confirmButtonText: 'OK'
                    //     })
                    alert('오류 발생');
                });
            });
            // about slider
        }

    //------------------------------document get ready------------------------------//
    document.addEventListener("DOMContentLoaded", function () {
        init();
        // 모바일 환경에서는 사이드 바가 토글되게
        const windowWidth = $(window).width();
        if (windowWidth <= 768) {
            $('body').toggleClass('sidebar-toggled');
            $('#accordionSidebar').toggleClass('toggled');
        }
    });


</script>

</html>